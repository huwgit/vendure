"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[4],{8004:(V,v,s)=>{s.r(v),s.d(v,{HealthCheckComponent:()=>_,JobListComponent:()=>u,JobStateLabelComponent:()=>m,SystemModule:()=>h,systemRoutes:()=>Z});var e=s(4386),a=s(6058),d=s(2493),c=s(3740),f=s(7062),p=s(9348),j=s(7537),A=s(9883),C=s(7341),E=s(4369),b=s(2583),g=s(5074),y=s(8570);function L(n,r){1&n&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"system.health-all-systems-up")," "))}function D(n,r){1&n&&(e._uU(0),e.ALo(1,"translate")),2&n&&e.hij(" ",e.lcZ(1,1,"system.health-error")," ")}const x=function(n,r){return{"is-success":n,"is-danger":r}};function P(n,r){if(1&n&&(e.TgZ(0,"div",7)(1,"div",8),e._UZ(2,"clr-icon",9),e.qZA(),e.TgZ(3,"div",10),e.YNc(4,L,3,3,"ng-container",11),e.YNc(5,D,2,3,"ng-template",null,12,e.W1O),e.TgZ(7,"div",13),e._uU(8),e.ALo(9,"translate"),e.ALo(10,"localeDate"),e.ALo(11,"async"),e.qZA()()()),2&n){const t=r.ngIf,o=e.MAs(6),l=e.oxw();e.xp6(2),e.Q6J("ngClass",e.WLB(13,x,"ok"===t,"ok"!==t)),e.uIk("shape","ok"===t?"check-circle":"exclamation-circle"),e.xp6(2),e.Q6J("ngIf","ok"===t)("ngIfElse",o),e.xp6(4),e.AsE(" ",e.lcZ(9,6,"system.health-last-checked"),": ",e.xi3(10,8,e.lcZ(11,11,l.healthCheckService.lastCheck$),"mediumTime")," ")}}function I(n,r){1&n&&(e.ynx(0),e._UZ(1,"clr-icon",17),e._uU(2),e.ALo(3,"translate"),e.BQk()),2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"system.health-status-up")," "))}function O(n,r){1&n&&(e._UZ(0,"clr-icon",18),e._uU(1),e.ALo(2,"translate")),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"system.health-status-down")," "))}function U(n,r){if(1&n&&(e.TgZ(0,"tr")(1,"td",14),e._uU(2),e.qZA(),e.TgZ(3,"td",14)(4,"vdr-chip",15),e.YNc(5,I,4,3,"ng-container",11),e.YNc(6,O,3,3,"ng-template",null,16,e.W1O),e.qZA()(),e.TgZ(8,"td",14),e._uU(9),e.qZA()()),2&n){const t=r.$implicit,o=e.MAs(7);e.xp6(2),e.Oqu(t.key),e.xp6(2),e.Q6J("colorType","up"===t.result.status?"success":"error"),e.xp6(1),e.Q6J("ngIf","up"===t.result.status)("ngIfElse",o),e.xp6(4),e.Oqu(t.result.message)}}function M(n,r){if(1&n&&(e.TgZ(0,"span",3),e._uU(1),e.ALo(2,"percent"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,t.job.progress/100)," ")}}function J(n,r){1&n&&(e.ynx(0),e.TgZ(1,"vdr-chip"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.BQk()),2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"system.all-job-queues")))}function w(n,r){if(1&n&&(e.TgZ(0,"vdr-chip",20),e._uU(1),e.qZA()),2&n){const t=e.oxw().item;e.Q6J("colorFrom",t.name),e.xp6(1),e.Oqu(t.name)}}function N(n,r){if(1&n&&(e.YNc(0,J,4,3,"ng-container",18),e.YNc(1,w,2,2,"ng-template",null,19,e.W1O)),2&n){const t=r.item,o=e.MAs(2);e.Q6J("ngIf","all"===t.name)("ngIfElse",o)}}function k(n,r){if(1&n&&e._uU(0),2&n){const t=r.item;e.hij(" ",t.id," ")}}function q(n,r){if(1&n&&(e._uU(0),e.ALo(1,"timeAgo")),2&n){const t=r.item;e.hij(" ",e.lcZ(1,1,t.createdAt)," ")}}function R(n,r){if(1&n&&(e.TgZ(0,"vdr-chip",20),e._uU(1),e.qZA()),2&n){const t=r.item;e.Q6J("colorFrom",t.queueName),e.xp6(1),e.Oqu(t.queueName)}}function F(n,r){if(1&n&&(e.TgZ(0,"vdr-dropdown")(1,"button",22),e.ALo(2,"translate"),e._UZ(3,"clr-icon",23),e.qZA(),e.TgZ(4,"vdr-dropdown-menu")(5,"div",24),e._UZ(6,"vdr-object-tree",4),e.qZA()()()),2&n){const t=e.oxw().item;e.xp6(1),e.Q6J("title",e.lcZ(2,2,"system.job-data")),e.xp6(5),e.Q6J("value",t.data)}}function Q(n,r){if(1&n&&e.YNc(0,F,7,4,"vdr-dropdown",21),2&n){const t=r.item;e.Q6J("ngIf",t.data)}}function B(n,r){if(1&n&&(e.TgZ(0,"div",27),e._uU(1),e.qZA()),2&n){const t=e.oxw().item;e.xp6(1),e.hij("after ",t.attempts," attempts")}}function W(n,r){if(1&n&&(e.TgZ(0,"div",27),e._uU(1),e.qZA()),2&n){const t=e.oxw().item;e.xp6(1),e.AsE(" attempting ",t.attempts," of ",t.retries+1," ")}}function S(n,r){if(1&n&&(e._UZ(0,"vdr-job-state-label",25),e.YNc(1,B,2,1,"div",26),e.YNc(2,W,2,2,"div",26)),2&n){const t=r.item;e.Q6J("job",t),e.xp6(1),e.Q6J("ngIf","FAILED"===t.state),e.xp6(1),e.Q6J("ngIf","RUNNING"===t.state||"RETRYING"===t.state)}}function K(n,r){if(1&n&&(e._uU(0),e.ALo(1,"duration")),2&n){const t=r.item;e.hij(" ",e.lcZ(1,1,t.duration)," ")}}function Y(n,r){if(1&n&&(e.TgZ(0,"vdr-dropdown")(1,"button",28),e._UZ(2,"clr-icon",23),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"vdr-dropdown-menu")(6,"div",24),e._UZ(7,"vdr-object-tree",4),e.qZA()()()),2&n){const t=e.oxw().item;e.xp6(3),e.hij(" ",e.lcZ(4,2,"system.job-result")," "),e.xp6(4),e.Q6J("value",t.result)}}function $(n,r){if(1&n&&(e.TgZ(0,"vdr-dropdown")(1,"button",29),e._UZ(2,"clr-icon",30),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"vdr-dropdown-menu")(6,"div",24),e._uU(7),e.qZA()()()),2&n){const t=e.oxw().item;e.xp6(3),e.hij(" ",e.lcZ(4,2,"system.job-error")," "),e.xp6(4),e.hij(" ",t.error," ")}}const G=function(){return["DeleteSettings","DeleteSystem"]};function H(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"vdr-dropdown")(1,"button",31),e._UZ(2,"clr-icon",32),e.qZA(),e.TgZ(3,"vdr-dropdown-menu",33)(4,"button",34),e.NdJ("click",function(){e.CHM(t);const l=e.oxw().item,i=e.oxw();return e.KtG(i.cancelJob(l.id))}),e.ALo(5,"hasPermission"),e._UZ(6,"clr-icon",35),e._uU(7),e.ALo(8,"translate"),e.qZA()()()}2&n&&(e.xp6(4),e.Q6J("disabled",!e.lcZ(5,2,e.DdM(6,G))),e.xp6(3),e.hij(" ",e.lcZ(8,4,"common.cancel")," "))}function z(n,r){if(1&n&&(e.YNc(0,Y,8,4,"vdr-dropdown",21),e.YNc(1,$,8,4,"vdr-dropdown",21),e.YNc(2,H,9,7,"vdr-dropdown",21)),2&n){const t=r.item,o=e.oxw();e.Q6J("ngIf",o.hasResult(t)),e.xp6(1),e.Q6J("ngIf",t.error),e.xp6(1),e.Q6J("ngIf",!t.isSettled&&"FAILED"!==t.state)}}class _{constructor(r){this.healthCheckService=r}static#e=this.\u0275fac=function(t){return new(t||_)(e.Y36(a.Gpz))};static#t=this.\u0275cmp=e.Xpm({type:_,selectors:[["vdr-health-check"]],decls:30,vars:18,consts:[["class","system-status-header",4,"ngIf"],["locationId","system-status"],[1,"btn","btn-secondary",3,"click"],["shape","refresh"],[1,"table"],[1,"left"],[4,"ngFor","ngForOf"],[1,"system-status-header"],[1,"status-icon"],["size","48",3,"ngClass"],[1,"status-detail"],[4,"ngIf","ngIfElse"],["error",""],[1,"last-checked"],[1,"align-middle","left"],[3,"colorType"],["down",""],["shape","check-circle"],["shape","exclamation-circle"]],template:function(t,o){1&t&&(e.TgZ(0,"vdr-page-header"),e._UZ(1,"vdr-page-title"),e.qZA(),e.TgZ(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left"),e.YNc(6,P,12,16,"div",0),e.ALo(7,"async"),e.qZA(),e.TgZ(8,"vdr-ab-right"),e._UZ(9,"vdr-action-bar-items",1),e.TgZ(10,"button",2),e.NdJ("click",function(){return o.healthCheckService.refresh()}),e._UZ(11,"clr-icon",3),e._uU(12),e.ALo(13,"translate"),e.qZA()()()(),e.TgZ(14,"vdr-page-block")(15,"table",4)(16,"thead")(17,"tr")(18,"th",5),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"th",5),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"th",5),e._uU(25),e.ALo(26,"translate"),e.qZA()()(),e.TgZ(27,"tbody"),e.YNc(28,U,10,5,"tr",6),e.ALo(29,"async"),e.qZA()()()()),2&t&&(e.xp6(6),e.Q6J("ngIf",e.lcZ(7,6,o.healthCheckService.status$)),e.xp6(6),e.hij(" ",e.lcZ(13,8,"system.health-refresh")," "),e.xp6(7),e.hij(" ",e.lcZ(20,10,"common.name")," "),e.xp6(3),e.hij(" ",e.lcZ(23,12,"system.health-status")," "),e.xp6(3),e.hij(" ",e.lcZ(26,14,"system.health-message")," "),e.xp6(3),e.Q6J("ngForOf",e.lcZ(29,16,o.healthCheckService.details$)))},dependencies:[d.qvL,c.mk,c.sg,c.O5,a.KkL,a.BND,a.mz,a.Ywx,a.WWO,a.qA0,a.TMj,a.HF2,a.zJY,c.Ov,f.X$,a.HbD],styles:[".system-status-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.system-status-header[_ngcontent-%COMP%]   .status-detail[_ngcontent-%COMP%]{font-weight:700;margin-inline-end:6px}.system-status-header[_ngcontent-%COMP%]   .last-checked[_ngcontent-%COMP%]{font-weight:400;color:var(--color-grey-500)}"],changeDetection:0})}class m{get iconShape(){switch(this.job.state){case a.Zyh.COMPLETED:return"check-circle";case a.Zyh.FAILED:return"exclamation-circle";case a.Zyh.CANCELLED:return"ban";case a.Zyh.PENDING:case a.Zyh.RETRYING:return"hourglass";case a.Zyh.RUNNING:return"sync"}}get colorType(){switch(this.job.state){case a.Zyh.COMPLETED:return"success";case a.Zyh.FAILED:case a.Zyh.CANCELLED:return"error";case a.Zyh.PENDING:case a.Zyh.RETRYING:return"";case a.Zyh.RUNNING:return"warning"}}static#e=this.\u0275fac=function(t){return new(t||m)};static#t=this.\u0275cmp=e.Xpm({type:m,selectors:[["vdr-job-state-label"]],inputs:{job:"job"},decls:5,vars:6,consts:[[3,"colorType"],[1,"mr1"],["class","progress",4,"ngIf"],[1,"progress"]],template:function(t,o){1&t&&(e.TgZ(0,"vdr-chip",0),e._UZ(1,"clr-icon",1),e._uU(2),e.ALo(3,"titlecase"),e.YNc(4,M,3,3,"span",2),e.qZA()),2&t&&(e.Q6J("colorType",o.colorType),e.xp6(1),e.uIk("shape",o.iconShape),e.xp6(1),e.hij(" ",e.lcZ(3,4,o.job.state)," "),e.xp6(2),e.Q6J("ngIf","RUNNING"===o.job.state))},dependencies:[d.qvL,c.O5,a.Ywx,c.Zx,c.rS],styles:[".progress[_ngcontent-%COMP%]{margin-inline-start:3px}clr-icon[_ngcontent-%COMP%]{min-width:12px}"],changeDetection:0})}class u extends a.t7C{constructor(r,t,o){super(t,o),this.dataService=r,this.liveUpdate=new p.NI(!0),this.queueFilter=new p.NI("all"),this.stateFilter=new p.NI(""),super.setQueryFn((...l)=>this.dataService.settings.getAllJobs(...l),l=>l.jobs,(l,i)=>{const X="all"===this.queueFilter.value?null:{queueName:{eq:this.queueFilter.value}},T=this.stateFilter.value;return{options:{skip:l,take:i,filter:{...X,...T?{state:{eq:T}}:{}},sort:{createdAt:a.Asd.DESC}}}})}ngOnInit(){super.ngOnInit(),(0,j.H)(5e3,2e3).pipe((0,A.R)(this.destroy$),(0,C.h)(()=>!!this.liveUpdate.value)).subscribe(()=>{this.refresh()}),this.queues$=this.dataService.settings.getJobQueues().mapStream(r=>r.jobQueues).pipe((0,E.U)(r=>[{name:"all",running:!0},...r]))}hasResult(r){const t=r.result;return null!=t&&("object"!=typeof t||Object.keys(t).length>0)}cancelJob(r){this.dataService.settings.cancelJob(r).subscribe(()=>this.refresh())}static#e=this.\u0275fac=function(t){return new(t||u)(e.Y36(a.DoR),e.Y36(b.F0),e.Y36(b.gz))};static#t=this.\u0275cmp=e.Xpm({type:u,selectors:[["vdr-job-list"]],features:[e.qOj],decls:67,vars:80,consts:[[1,"mr-2"],["type","checkbox","clrCheckbox","","name","live-update",3,"formControl"],["locationId","job-list"],[1,"mr-2",3,"addTag","hideSelected","multiple","markFirst","clearable","searchable","formControl","change"],[3,"value"],["colorType","warning"],["colorType","success"],["colorType","error"],["bindValue","name",3,"addTag","items","hideSelected","multiple","markFirst","clearable","searchable","formControl","change"],["ng-label-tmp","","ng-option-tmp",""],["id","job-list",3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],["id","id",3,"heading"],["id","created-at",3,"heading"],["id","job-queue-name",3,"heading","optional"],["id","job-data",3,"heading","optional"],["id","job-state",3,"heading"],["id","job-duration",3,"heading"],["id","job-result",3,"heading"],[4,"ngIf","ngIfElse"],["others",""],[3,"colorFrom"],[4,"ngIf"],["vdrDropdownTrigger","",1,"button-small",3,"title"],["shape","details"],[1,"result-detail"],[3,"job"],["class","retry-info",4,"ngIf"],[1,"retry-info"],["vdrDropdownTrigger","",1,"button-small","mr-1"],["vdrDropdownTrigger","",1,"button-small"],["shape","exclamation-circle"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical","size","12"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","ban",1,"is-danger"]],template:function(t,o){1&t&&(e.TgZ(0,"vdr-page-header"),e._UZ(1,"vdr-page-title"),e.qZA(),e.TgZ(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left")(6,"clr-checkbox-wrapper",0),e._UZ(7,"input",1),e.TgZ(8,"label"),e._uU(9),e.ALo(10,"translate"),e.qZA()()(),e.TgZ(11,"vdr-ab-right"),e._UZ(12,"vdr-action-bar-items",2),e.TgZ(13,"ng-select",3),e.NdJ("change",function(){return o.refresh()}),e.TgZ(14,"ng-option",4)(15,"vdr-chip"),e._uU(16),e.ALo(17,"translate"),e.qZA()(),e.TgZ(18,"ng-option",4)(19,"vdr-chip"),e._uU(20),e.ALo(21,"translate"),e.qZA()(),e.TgZ(22,"ng-option",4)(23,"vdr-chip",5),e._uU(24),e.ALo(25,"translate"),e.qZA()(),e.TgZ(26,"ng-option",4)(27,"vdr-chip",6),e._uU(28),e.ALo(29,"translate"),e.qZA()(),e.TgZ(30,"ng-option",4)(31,"vdr-chip",7),e._uU(32),e.ALo(33,"translate"),e.qZA()(),e.TgZ(34,"ng-option",4)(35,"vdr-chip",7),e._uU(36),e.ALo(37,"translate"),e.qZA()()(),e.TgZ(38,"ng-select",8),e.NdJ("change",function(){return o.refresh()}),e.ALo(39,"async"),e.YNc(40,N,3,2,"ng-template",9),e.qZA()()()(),e.TgZ(41,"vdr-data-table-2",10),e.NdJ("pageChange",function(i){return o.setPageNumber(i)})("itemsPerPageChange",function(i){return o.setItemsPerPage(i)}),e.ALo(42,"async"),e.ALo(43,"async"),e.ALo(44,"async"),e.ALo(45,"async"),e.TgZ(46,"vdr-dt2-column",11),e.ALo(47,"translate"),e.YNc(48,k,1,1,"ng-template"),e.qZA(),e.TgZ(49,"vdr-dt2-column",12),e.ALo(50,"translate"),e.YNc(51,q,2,3,"ng-template"),e.qZA(),e.TgZ(52,"vdr-dt2-column",13),e.ALo(53,"translate"),e.YNc(54,R,2,2,"ng-template"),e.qZA(),e.TgZ(55,"vdr-dt2-column",14),e.ALo(56,"translate"),e.YNc(57,Q,1,1,"ng-template"),e.qZA(),e.TgZ(58,"vdr-dt2-column",15),e.ALo(59,"translate"),e.YNc(60,S,3,3,"ng-template"),e.qZA(),e.TgZ(61,"vdr-dt2-column",16),e.ALo(62,"translate"),e.YNc(63,K,2,3,"ng-template"),e.qZA(),e.TgZ(64,"vdr-dt2-column",17),e.ALo(65,"translate"),e.YNc(66,z,3,3,"ng-template"),e.qZA()()()),2&t&&(e.xp6(7),e.Q6J("formControl",o.liveUpdate),e.xp6(2),e.Oqu(e.lcZ(10,42,"common.live-update")),e.xp6(4),e.Q6J("addTag",!1)("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",o.stateFilter),e.xp6(1),e.Q6J("value",""),e.xp6(2),e.Oqu(e.lcZ(17,44,"system.job-state-all")),e.xp6(2),e.Q6J("value","PENDING"),e.xp6(2),e.Oqu(e.lcZ(21,46,"system.job-state-pending")),e.xp6(2),e.Q6J("value","RUNNING"),e.xp6(2),e.Oqu(e.lcZ(25,48,"system.job-state-running")),e.xp6(2),e.Q6J("value","COMPLETED"),e.xp6(2),e.Oqu(e.lcZ(29,50,"system.job-state-completed")),e.xp6(2),e.Q6J("value","FAILED"),e.xp6(2),e.Oqu(e.lcZ(33,52,"system.job-state-failed")),e.xp6(2),e.Q6J("value","CANCELLED"),e.xp6(2),e.Oqu(e.lcZ(37,54,"system.job-state-cancelled")),e.xp6(2),e.Q6J("addTag",!1)("items",e.lcZ(39,56,o.queues$))("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",o.queueFilter),e.xp6(3),e.Q6J("items",e.lcZ(42,58,o.items$))("itemsPerPage",e.lcZ(43,60,o.itemsPerPage$))("totalItems",e.lcZ(44,62,o.totalItems$))("currentPage",e.lcZ(45,64,o.currentPage$)),e.xp6(5),e.Q6J("heading",e.lcZ(47,66,"common.id")),e.xp6(3),e.Q6J("heading",e.lcZ(50,68,"common.created-at")),e.xp6(3),e.Q6J("heading",e.lcZ(53,70,"system.job-queue-name"))("optional",!1),e.xp6(3),e.Q6J("heading",e.lcZ(56,72,"system.job-data"))("optional",!1),e.xp6(3),e.Q6J("heading",e.lcZ(59,74,"system.job-state")),e.xp6(3),e.Q6J("heading",e.lcZ(62,76,"system.job-duration")),e.xp6(3),e.Q6J("heading",e.lcZ(65,78,"system.job-result")))},dependencies:[d.qvL,d.MgK,d.KKC,d.PEh,c.O5,p.Wl,p.JJ,p.oH,g.w9,g.jq,g.ir,g.mR,a.KkL,a.BND,a.mz,a.Ywx,a.y_K,a.JOL,a.N9E,a.UaT,a.HH4,a._8q,a.WWO,a.eJ5,a.Up6,a.qA0,a.TMj,a.HF2,a.zJY,m,c.Ov,f.X$,a.j$k,a.eGd,a.uGI],styles:[".result-detail[_ngcontent-%COMP%]{margin:0 12px}.retry-info[_ngcontent-%COMP%]{margin-inline-start:6px;color:var(--color-grey-400)}"],changeDetection:0})}const Z=[{path:"jobs",component:u,data:{breadcrumb:(0,y.J)("breadcrumb.job-queue")}},{path:"system-status",component:_,data:{breadcrumb:(0,y.J)("breadcrumb.system-status")}}];class h{static#e=this.\u0275fac=function(t){return new(t||h)};static#t=this.\u0275mod=e.oAB({type:h});static#n=this.\u0275inj=e.cJS({imports:[a.m81,b.Bz.forChild(Z)]})}}}]);
//# sourceMappingURL=4.d5cb77ae43959881.js.map